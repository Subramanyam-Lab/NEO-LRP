"""
Generate latex tables comparing NEO-DS against state-of-the-art methods
(TSBA_basic, HGAMP) on the Schneider benchmark. Splits results
into three tables by problem size (100-200, 300-400, 500-600 customers)
with computed averages for each table.
"""
import pandas as pd
import re
import numpy as np


def normalize_instance(name: str) -> str:
    return name.replace(".json", "").strip()


excel_ds = "NEO-LRP/neo-lrp/output/S_schneider/S_schneider_deepsets_110000_cost_over_fi_vroom.xlsx"

print("\nLoading NEO-DS Excel")
df_ds = pd.read_excel(excel_ds, sheet_name="results", header=0)
df_ds.columns = df_ds.columns.astype(str).str.strip()
df_ds["Instance"] = df_ds["Instance"].apply(normalize_instance)
print("DS Instances found:", df_ds["Instance"].unique())

df_ds["gap"] = df_ds["Optimization_gap_signed"]
df_ds["T_LA"] = df_ds["NN model execution time"]
df_ds["T_total"] = df_ds["NN model execution time"] + df_ds["vroom model solve time"]

neo_ds_dict = {
    row["Instance"]: (row["gap"], row["T_LA"], row["T_total"])
    for _, row in df_ds.iterrows()
}
print("DS dict keys:", list(neo_ds_dict.keys())[:10])

all_rows = """100-5-1c & 134516 & 0.07 & 81 & 0.00 & 1070 & 3.44 & 0.25 & 0.84 \\\\
100-5-1d & 275749 & 0.02 & 53 & 0.00 & 950 & 1.88 & 1.17 & 2.04 \\\\
100-5-1e & 292301 & 0.03 & 69 & 0.32 & 1104 & 0.91 & 0.27 & 1.82 \\\\
100-5-2c & 83855 & 0.45 & 67 & 0.15 & 1070 & 4.70 & 0.21 & 0.97 \\\\
100-5-2d & 242105 & 0.13 & 52 & 0.00 & 1099 & 1.15 & 1.17 & 2.13 \\\\
100-5-2e & 253888 & 0.07 & 66 & 0.05 & 2171 & 0.34 & 0.24 & 4.42 \\\\
100-5-3c & 87555 & 0.06 & 55 & 0.00 & 949 & 5.54 & 0.17 & 0.68 \\\\
100-5-3d & 226634 & 0.09 & 49 & 0.06 & 892 & 1.02 & 0.61 & 1.39 \\\\
100-5-3e & 252603 & 0.02 & 79 & 0.01 & 1436 & 0.54 & 0.27 & 4.33 \\\\
100-5-4a & 255853 & 0.02 & 52 & 0.00 & 1087 & 1.62 & 0.28 & 1.17 \\\\
100-5-4b & 214425 & 0.00 & 30 & 0.00 & 1068 & 2.50 & 0.30 & 1.12 \\\\
100-5-4c & 98104 & 0.09 & 53 & 0.01 & 1091 & 5.10 & 0.32 & 1.22 \\\\
100-5-4d & 250301 & 0.19 & 46 & 0.28 & 1062 & 1.89 & 1.02 & 2.00 \\\\
100-5-4e & 211113 & 0.05 & 58 & 0.07 & 1651 & 1.28 & 11.51 & 13.28 \\\\
100-10-1c & 92629 & 0.06 & 98 & 0.00 & 1285 & 8.28 & 0.59 & 0.70 \\\\
100-10-1d & 363930 & 0.07 & 61 & 0.00 & 1132 & 0.70 & 1.53 & 1.85 \\\\
100-10-1e & 344322 & 0.08 & 60 & 0.15 & 1114 & 1.18 & 1.33 & 2.30 \\\\
100-10-2c & 84717 & 0.03 & 99 & 0.00 & 1169 & 16.69 & 1.28 & 1.54 \\\\
100-10-2d & 343252 & 0.00 & 56 & 0.00 & 1255 & 1.39 & 1.33 & 1.70 \\\\
100-10-2e & 332900 & 0.08 & 61 & 0.26 & 1000 & 1.44 & 1.28 & 2.14 \\\\
100-10-3c & 85369 & 0.40 & 97 & 0.00 & 1129 & 10.18 & 1.01 & 1.16 \\\\
100-10-3d & 329990 & 0.01 & 52 & 0.01 & 1161 & 0.67 & 1.08 & 1.39 \\\\
100-10-3e & 318109 & 0.05 & 64 & 0.04 & 1185 & 0.63 & 1.34 & 2.15 \\\\
100-10-4a & 253471 & 0.29 & 48 & 0.01 & 1333 & 0.72 & 19.10 & 20.01 \\\\
100-10-4b & 211354 & 0.00 & 39 & 0.00 & 1340 & 1.88 & 25.87 & 26.60 \\\\
100-10-4c & 86215 & 0.00 & 74 & 0.00 & 1320 & 6.90 & 1.03 & 1.44 \\\\
100-10-4d & 328181 & 0.05 & 63 & 0.07 & 1381 & 0.83 & 1.30 & 1.65 \\\\
100-10-4e & 308757 & 0.18 & 72 & 0.36 & 1320 & 1.83 & 0.76 & 1.58 \\\\
200-10-1c & 156029 & 0.48 & 590 & 0.09 & 3218 & 5.17 & 1.80 & 2.80 \\\\
200-10-1d & 638068 & 0.32 & 418 & 0.19 & 2590 & 0.78 & 3.75 & 5.87 \\\\
200-10-1e & 599069 & 0.11 & 464 & 0.35 & 2521 & 1.57 & 12.26 & 17.47 \\\\
200-10-2c & 144046 & 0.23 & 476 & 0.21 & 2756 & 2.53 & 2.64 & 4.90 \\\\
200-10-2d & 663154 & 0.16 & 343 & 0.14 & 2801 & 0.82 & 1.60 & 3.60 \\\\
200-10-2e & 618858 & 0.05 & 318 & 0.11 & 2834 & 0.66 & 1.59 & 6.29 \\\\
200-10-3c & 184783 & 0.61 & 588 & 0.66 & 2651 & 5.90 & 19.42 & 21.88 \\\\
200-10-3d & 640289 & 0.02 & 385 & 0.18 & 2542 & 2.25 & 1.74 & 4.04 \\\\
200-10-3e & 604480 & 0.13 & 388 & 0.33 & 2509 & 1.55 & 2.38 & 7.60 \\\\
200-10-4a & 452430 & 0.15 & 316 & 0.13 & 2997 & 1.18 & 89.60 & 94.31 \\\\
200-10-4b & 369580 & 0.18 & 215 & 0.10 & 3254 & 0.89 & 17.89 & 22.35 \\\\
200-10-4c & 144013 & 0.41 & 611 & 0.34 & 3323 & 6.58 & 1.79 & 3.09 \\\\
200-10-4d & 617932 & 0.18 & 370 & 0.15 & 3105 & 0.62 & 2.97 & 4.94 \\\\
200-10-4e & 562843 & 0.10 & 403 & 0.19 & 2959 & 1.00 & 2.81 & 8.13 \\\\
200-15-1a & 460430 & 0.29 & 589 & 0.33 & 2728 & 1.06 & 85.45 & 89.84 \\\\
200-15-1b & 366359 & 0.38 & 274 & 0.18 & 2781 & 1.75 & 64.98 & 68.68 \\\\
200-15-1c & 148141 & 0.71 & 692 & 0.67 & 3693 & 7.95 & 3.51 & 4.41 \\\\
200-15-1d & 813576 & 0.12 & 593 & 0.16 & 2755 & 1.17 & 73.21 & 74.38 \\\\
200-15-1e & 708585 & 1.58 & 624 & 0.16 & 2834 & 0.58 & 3.50 & 5.56 \\\\
200-15-2a & 513512 & 0.11 & 627 & 0.15 & 3046 & 0.79 & 164.56 & 169.14 \\\\
200-15-2b & 406685 & 0.11 & 271 & 0.06 & 3046 & 1.64 & 216.64 & 221.26 \\\\
200-15-2c & 134779 & 0.54 & 466 & 0.42 & 3599 & 7.06 & 4.51 & 5.41 \\\\
200-15-2d & 811361 & 0.14 & 544 & 0.22 & 2854 & 1.53 & 24.91 & 25.93 \\\\
200-15-2e & 712524 & 0.09 & 569 & 0.29 & 3326 & 2.04 & 268.89 & 271.13 \\\\
200-15-3a & 455351 & 0.16 & 558 & 0.07 & 2871 & 1.26 & 101.05 & 105.69 \\\\
200-15-3b & 356887 & 0.26 & 218 & 0.11 & 2933 & 0.98 & 61.17 & 65.45 \\\\
200-15-3c & 140765 & 0.56 & 536 & 0.24 & 3741 & 8.68 & 4.33 & 4.94 \\\\
200-15-3d & 877543 & 0.10 & 502 & 0.10 & 2551 & 1.44 & 4.34 & 5.39 \\\\
200-15-3e & 816001 & 0.12 & 524 & 0.05 & 2723 & 0.55 & 30.98 & 32.69 \\\\
200-15-4a & 432672 & 0.23 & 580 & 0.15 & 3260 & 0.66 & 520.94 & 525.94 \\\\
200-15-4b & 349088 & 0.20 & 274 & 0.14 & 3224 & 0.96 & 298.16 & 302.90 \\\\
200-15-4c & 143052 & 0.71 & 558 & 0.48 & 3807 & 9.51 & 4.62 & 5.69 \\\\
200-15-4d & 826829 & 0.18 & 547 & 0.14 & 2947 & 1.64 & 38.12 & 39.31 \\\\
200-15-4e & 700013 & 0.15 & 744 & 0.24 & 3050 & 1.14 & 5.01 & 8.07 \\\\
300-15-1a & 854503 & 0.31 & 2085 & 0.38 & 4776 & 2.41 & 46.18 & 57.72 \\\\
300-15-1b & 621894 & 0.39 & 1387 & 0.23 & 5066 & 1.30 & 158.56 & 169.48 \\\\
300-15-1c & 364979 & 0.86 & 1613 & 0.18 & 6459 & 5.51 & 5.35 & 7.62 \\\\
300-15-1d & 1337930 & 0.14 & 1557 & 0.09 & 4300 & 1.17 & 145.99 & 149.15 \\\\
300-15-1e & 1217690 & 0.39 & 1949 & 0.25 & 4740 & 1.82 & 109.47 & 115.51 \\\\
300-15-2a & 757931 & 0.31 & 2135 & 0.38 & 5265 & 1.43 & 17.68 & 29.57 \\\\
300-15-2b & 556948 & 0.40 & 1250 & 0.12 & 4935 & 0.89 & 13.69 & 24.33 \\\\
300-15-2c & 310061 & 0.83 & 1465 & 0.31 & 6299 & 3.66 & 6.74 & 9.63 \\\\
300-15-2d & 1301210 & 0.17 & 1579 & 0.12 & 4937 & 1.47 & 77.02 & 79.99 \\\\
300-15-2e & 1272700 & 0.26 & 1853 & 0.33 & 4915 & 1.73 & 67.18 & 72.39 \\\\
300-15-3a & 776531 & 0.24 & 1897 & 0.21 & 5246 & 0.96 & 11.01 & 21.18 \\\\
300-15-3b & 593743 & 0.21 & 1065 & 0.04 & 4857 & 0.43 & 158.94 & 169.42 \\\\
300-15-3c & 340155 & 0.52 & 1434 & 0.60 & 6186 & 4.01 & 6.13 & 7.99 \\\\
300-15-3d & 1355890 & 0.30 & 1495 & 0.15 & 4595 & 0.96 & 151.24 & 154.25 \\\\
300-15-3e & 1286877 & 0.13 & 2209 & 0.20 & 4778 & 1.45 & 7.08 & 15.70 \\\\
300-15-4a & 746407 & 0.35 & 1976 & 0.46 & 5757 & 1.18 & 66.49 & 79.23 \\\\
300-15-4b & 558831 & 0.26 & 1291 & 0.08 & 5236 & 1.23 & 171.18 & 182.46 \\\\
300-15-4c & 302390 & 0.74 & 1843 & 0.42 & 6658 & 3.59 & 6.25 & 10.91 \\\\
300-15-4d & 1285714 & 0.32 & 1779 & 0.25 & 4785 & 1.42 & 178.40 & 181.73 \\\\
300-15-4e & 1172200 & 0.26 & 1939 & 0.14 & 5074 & 0.89 & 69.23 & 77.72 \\\\
300-20-1a & 944798 & 7.04 & 1613 & 0.34 & 5098 & 1.09 & 15.89 & 23.49 \\\\
300-20-1b & 739410 & 2.14 & 1409 & 0.34 & 5252 & 0.49 & 15.20 & 22.59 \\\\
300-20-1c & 361735 & 0.85 & 1554 & 0.29 & 6816 & 8.83 & 9.14 & 10.14 \\\\
300-20-1d & 1572968 & 0.26 & 1625 & 0.38 & 5239 & 1.95 & 10.17 & 12.14 \\\\
300-20-1e & 1316880 & 5.78 & 1602 & 0.31 & 4772 & 1.77 & 37.92 & 46.46 \\\\
300-20-2a & 909306 & 0.16 & 2044 & 0.37 & 5634 & 1.20 & 82.57 & 90.36 \\\\
300-20-2b & 694525 & 0.26 & 1437 & 0.20 & 5731 & 0.96 & 15.97 & 23.22 \\\\
300-20-2c & 298522 & 0.64 & 1564 & 0.34 & 6632 & 4.45 & 10.19 & 11.97 \\\\
300-20-2d & 1569042 & 0.10 & 1900 & 0.22 & 5864 & 1.08 & 8.89 & 10.88 \\\\
300-20-2e & 1282040 & 8.29 & 2240 & 0.21 & 4994 & 0.85 & 8.14 & 20.30 \\\\
300-20-3a & 927452 & 0.36 & 1779 & 0.31 & 4924 & 1.13 & 439.32 & 446.66 \\\\
300-20-3b & 750633 & 0.17 & 1425 & 0.23 & 4980 & 0.62 & 279.70 & 286.61 \\\\
300-20-3c & 304269 & 0.96 & 1177 & 0.42 & 6277 & 7.29 & 10.00 & 12.19 \\\\
300-20-3d & 1538930 & 0.14 & 1657 & 0.15 & 4736 & 1.16 & 58.72 & 60.69 \\\\
300-20-3e & 1261660 & 2.30 & 2091 & 0.16 & 4501 & 1.55 & 129.68 & 138.59 \\\\
300-20-4a & 858649 & 0.17 & 1993 & 0.14 & 5835 & 1.16 & 48.29 & 56.73 \\\\
300-20-4b & 687179 & 0.33 & 1333 & 0.16 & 5952 & 1.69 & 211.05 & 219.11 \\\\
300-20-4c & 299157 & 0.66 & 1678 & 0.13 & 7350 & 5.71 & 8.68 & 11.35 \\\\
300-20-4d & 1539900 & 0.17 & 1751 & 0.18 & 5911 & 0.50 & 50.97 & 53.01 \\\\
300-20-4e & 1322150 & 1.76 & 2624 & 0.20 & 5384 & 1.35 & 105.33 & 114.62 \\\\
400-20-1a & 1139820 & 0.27 & 5460 & 0.27 & 7168 & 0.88 & 486.13 & 501.40 \\\\
400-20-1b & 876157 & 0.57 & 2844 & 0.29 & 7833 & 1.06 & 657.95 & 672.88 \\\\
400-20-1c & 466857 & 0.73 & 3935 & 0.28 & 10503 & 6.52 & 12.45 & 16.10 \\\\
400-20-1d & 1956824 & 0.20 & 3780 & 0.49 & 8334 & 1.84 & 16.03 & 20.45 \\\\
400-20-1e & 1641880 & 6.64 & 4669 & 0.20 & 6697 & 1.93 & 115.67 & 131.14 \\\\
400-20-2a & 1053445 & 0.15 & 5850 & 0.33 & 8246 & 1.44 & 109.96 & 124.69 \\\\
400-20-2b & 827077 & 0.36 & 2957 & 0.15 & 7771 & 0.56 & 316.33 & 329.84 \\\\
400-20-2c & 394544 & 0.39 & 3976 & 0.32 & 10390 & 3.98 & 13.53 & 18.16 \\\\
400-20-2d & 1875072 & 0.14 & 4029 & 0.14 & 8307 & 1.02 & 15.78 & 20.18 \\\\
400-20-2e & 1560160 & 3.21 & 6085 & 0.13 & 6865 & 1.28 & 62.15 & 79.74 \\\\
400-20-3a & 1098670 & 0.20 & 4705 & 0.13 & 7985 & 0.63 & 27.59 & 44.85 \\\\
400-20-3b & 847311 & 0.40 & 2731 & 0.22 & 7438 & 0.70 & 574.42 & 589.43 \\\\
400-20-3c & 390047 & 0.82 & 2898 & 0.29 & 9916 & 3.41 & 13.54 & 16.18 \\\\
400-20-3d & 1927290 & 0.19 & 3356 & 0.12 & 7306 & 1.12 & 14.31 & 18.33 \\\\
400-20-3e & 1656860 & 7.45 & 5252 & 0.22 & 6896 & 0.95 & 37.23 & 54.28 \\\\
400-20-4a & 1080890 & 0.23 & 5802 & 0.21 & 8612 & 1.24 & 153.09 & 169.26 \\\\
400-20-4b & 841464 & 0.44 & 3261 & 0.21 & 9067 & 1.71 & 338.75 & 355.14 \\\\
400-20-4c & 350273 & 0.55 & 2671 & 0.37 & 10777 & 5.10 & 16.98 & 23.80 \\\\
400-20-4d & 1834809 & 0.09 & 4318 & 0.18 & 9223 & 0.75 & 63.99 & 68.61 \\\\
400-20-4e & 1558411 & 4.07 & 4993 & 0.15 & 8343 & 1.39 & 10.36 & 21.20 \\\\
400-25-1a & 1153960 & 0.24 & 5401 & 0.30 & 7789 & 1.65 & 125.43 & 139.05 \\\\
400-25-1b & 889193 & 0.34 & 2878 & 0.15 & 7763 & 0.98 & 440.19 & 454.93 \\\\
400-25-1c & 393581 & 0.78 & 3579 & 0.29 & 12532 & 5.88 & 21.44 & 22.74 \\\\
400-25-1d & 2336630 & 0.31 & 3282 & 0.05 & 7791 & 0.66 & 680.21 & 683.17 \\\\
400-25-1e & 1863200 & 10.48 & 4181 & 0.11 & 6579 & 0.42 & 102.58 & 116.28 \\\\
400-25-2a & 1090120 & 0.19 & 7027 & 0.15 & 8625 & 0.45 & 893.59 & 909.58 \\\\
400-25-2b & 867716 & 0.26 & 3608 & 0.18 & 8011 & 1.65 & 991.08 & 1003.88 \\\\
400-25-2c & 359606 & 0.61 & 3497 & 0.24 & 11149 & 4.85 & 23.10 & 26.22 \\\\
400-25-2d & 2351903 & 0.07 & 3710 & 0.17 & 7520 & 0.99 & 834.05 & 837.48 \\\\
400-25-2e & 1902730 & 4.26 & 4965 & 0.13 & 7902 & 1.09 & 274.24 & 283.33 \\\\
400-25-3a & 1105783 & 0.11 & 5606 & 0.30 & 8249 & 0.65 & 97.79 & 111.95 \\\\
400-25-3b & 861981 & 0.42 & 3396 & 0.22 & 8212 & 1.09 & 669.06 & 682.42 \\\\
400-25-3c & 392264 & 0.58 & 2998 & 0.22 & 9778 & 4.74 & 24.44 & 26.46 \\\\
400-25-3d & 2321358 & 0.12 & 4212 & 0.26 & 7728 & 1.00 & 981.10 & 983.90 \\\\
400-25-3e & 1890950 & 3.16 & 4099 & 0.21 & 6966 & 0.80 & 220.49 & 229.85 \\\\
400-25-4a & 1014350 & 0.24 & 5540 & 0.25 & 8496 & 0.97 & 587.29 & 603.37 \\\\
400-25-4b & 801135 & 0.25 & 3118 & 0.13 & 9085 & 1.13 & 221.78 & 238.22 \\\\
400-25-4c & 378419 & 0.89 & 3195 & 0.16 & 11428 & 5.16 & 20.92 & 27.41 \\\\
400-25-4d & 2360020 & 0.21 & 4334 & 0.13 & 8912 & 0.80 & 1067.81 & 1070.96 \\\\
400-25-4e & 1935600 & 2.99 & 4204 & 0.18 & 7785 & 0.69 & 21.77 & 31.28 \\\\
500-25-1a & 1771040 & 0.22 & 10864 & 0.10 & 10235 & 0.70 & 875.16 & 899.34 \\\\
500-25-1b & 1327800 & 0.50 & 5803 & 0.28 & 10432 & 0.94 & 514.26 & 539.51 \\\\
500-25-1c & 670025 & 0.86 & 6001 & 0.35 & 16214 & 4.36 & 32.90 & 36.15 \\\\
500-25-1d & 3321740 & 0.22 & 6627 & 0.09 & 10120 & 0.52 & 318.73 & 323.70 \\\\
500-25-1e & 2682740 & 10.91 & 7694 & 0.29 & 9314 & 0.90 & 18.32 & 38.78 \\\\
500-25-2a & 1619689 & 0.17 & 11998 & 0.21 & 12081 & 1.00 & 192.56 & 217.21 \\\\
500-25-2b & 1250270 & 0.31 & 5213 & 0.09 & 9587 & 0.58 & 224.27 & 248.45 \\\\
500-25-2c & 571155 & 0.97 & 5694 & 0.22 & 14168 & 4.31 & 28.89 & 34.03 \\\\
500-25-2d & 3335790 & 0.13 & 8014 & 0.09 & 10595 & 0.67 & 572.80 & 578.17 \\\\
500-25-2e & 2725350 & 5.02 & 11992 & 0.13 & 10784 & 0.70 & 71.45 & 91.25 \\\\
500-25-3a & 1724540 & 0.25 & 13855 & 0.23 & 10792 & 0.79 & 173.57 & 199.45 \\\\
500-25-3b & 1302820 & 0.32 & 5421 & 0.20 & 11222 & 1.02 & 994.62 & 1018.30 \\\\
500-25-3c & 578519 & 0.81 & 5099 & 0.26 & 14532 & 3.96 & 26.01 & 29.74 \\\\
500-25-3d & 3248557 & 0.05 & 6323 & 0.21 & 8733 & 0.97 & 1512.42 & 1517.61 \\\\
500-25-3e & 2681360 & 4.28 & 11756 & 0.17 & 10272 & 1.35 & 41.26 & 62.76 \\\\
500-25-4a & 1653680 & 0.30 & 13964 & 0.21 & 12931 & 1.49 & 207.02 & 235.25 \\\\
500-25-4b & 1259400 & 0.62 & 6661 & 0.22 & 11870 & 1.98 & 416.23 & 441.28 \\\\
500-25-4c & 664089 & 0.52 & 7012 & 0.45 & 14370 & 4.24 & 34.17 & 43.94 \\\\
500-25-4d & 3362588 & 0.06 & 8394 & 0.31 & 12719 & 1.24 & 972.71 & 978.20 \\\\
500-25-4e & 2625360 & 2.80 & 11932 & 0.17 & 11268 & 0.69 & 135.73 & 157.78 \\\\
500-30-1a & 1984150 & 0.36 & 11301 & 0.87 & 11688 & 0.67 & 71.89 & 90.17 \\\\
500-30-1b & 1532670 & 0.54 & 6369 & 0.40 & 11862 & 0.82 & 306.68 & 324.53 \\\\
500-30-1c & 611584 & 1.07 & 6389 & 0.22 & 15736 & 5.80 & 30.83 & 33.02 \\\\
500-30-1d & 3740220 & 0.15 & 6002 & 0.17 & 12247 & 1.42 & 259.39 & 263.01 \\\\
500-30-1e & 3236740 & 7.79 & 7836 & 0.19 & 11263 & 1.22 & 216.69 & 229.52 \\\\
500-30-2a & 1820346 & 0.13 & 15908 & 0.21 & 12927 & 1.12 & 437.05 & 455.37 \\\\
500-30-2b & 1452028 & 0.68 & 6908 & 0.24 & 12417 & 1.20 & 59.91 & 77.52 \\\\
500-30-2c & 647932 & 0.65 & 5547 & 0.27 & 15833 & 5.78 & 31.04 & 37.93 \\\\
500-30-2d & 3815210 & 0.02 & 8543 & 0.10 & 11682 & 1.73 & 21.35 & 25.17 \\\\
500-30-2e & 3218410 & 3.91 & 9895 & 0.18 & 11132 & 0.45 & 77.41 & 90.07 \\\\
500-30-3a & 1781220 & 0.20 & 9979 & 0.15 & 11986 & 1.36 & 68.65 & 87.82 \\\\
500-30-3b & 1417870 & 0.44 & 5206 & 0.20 & 10957 & 1.48 & 70.12 & 86.90 \\\\
500-30-3c & 567988 & 0.91 & 5936 & 0.29 & 12775 & 4.70 & 35.05 & 38.77 \\\\
500-30-3d & 3690995 & 0.12 & 8058 & 0.41 & 11606 & 1.01 & 188.18 & 191.83 \\\\
500-30-3e & 3059470 & 7.39 & 10411 & 2.52 & 10203 & 2.71 & 156.21 & 172.39 \\\\
500-30-4a & 1716476 & 0.36 & 12071 & 0.37 & 13181 & 1.81 & 395.23 & 413.59 \\\\
500-30-4b & 1398401 & 4.50 & 6314 & 0.62 & 13323 & 1.70 & 245.50 & 263.59 \\\\
500-30-4c & 558398 & 1.19 & 9257 & 0.32 & 13568 & 5.94 & 34.44 & 42.96 \\\\
500-30-4d & 3708479 & 0.08 & 8341 & 0.40 & 14431 & 0.83 & 43.12 & 46.98 \\\\
500-30-4e & 3057950 & 5.21 & 9918 & 0.92 & 11804 & 0.62 & 26.20 & 41.76 \\\\
600-30-1a & 2197860 & 0.13 & 20141 & 0.24 & 15026 & 0.70 & 1102.76 & 1129.95 \\\\
600-30-1b & 1689980 & 0.46 & 10673 & 0.35 & 15707 & 0.71 & 1447.16 & 1474.77 \\\\
600-30-1c & 742450 & 1.41 & 10822 & 0.44 & 19931 & 5.25 & 47.70 & 51.31 \\\\
600-30-1d & 4213337 & 0.09 & 14804 & 0.38 & 16852 & 0.58 & 281.83 & 288.23 \\\\
600-30-1e & 3552440 & 8.19 & 15500 & 0.16 & 14743 & 0.70 & 209.55 & 233.40 \\\\
600-30-2a & 2015580 & 0.18 & 23639 & 0.15 & 14461 & 0.99 & 277.82 & 307.02 \\\\
600-30-2b & 1601140 & 0.23 & 10779 & 0.10 & 14258 & 1.20 & 1489.49 & 1515.67 \\\\
600-30-2c & 633935 & 0.70 & 10719 & 0.21 & 16477 & 2.75 & 45.62 & 51.69 \\\\
600-30-2d & 4160240 & 0.16 & 15024 & 0.11 & 15083 & 0.73 & 272.19 & 279.11 \\\\
600-30-2e & 3563860 & 4.22 & 15010 & 0.61 & 14761 & 0.78 & 37.27 & 57.51 \\\\
600-30-3a & 2082824 & 0.18 & 24898 & 0.48 & 15086 & 0.89 & 881.73 & 909.03 \\\\
600-30-3b & 1612210 & 0.54 & 10761 & 0.26 & 15231 & 1.03 & 475.45 & 505.33 \\\\
600-30-3c & 658376 & 0.98 & 9549 & 0.36 & 18726 & 2.98 & 48.56 & 53.80 \\\\
600-30-3d & 4068474 & 0.07 & 15657 & 0.46 & 14432 & 0.99 & 61.96 & 67.90 \\\\
600-30-3e & 3327790 & 5.33 & 15180 & 0.23 & 12476 & 1.41 & 31.31 & 56.49 \\\\
600-30-4a & 1938780 & 0.27 & 25361 & 0.21 & 15596 & 1.36 & 1634.74 & 1660.38 \\\\
600-30-4b & 1554350 & 0.46 & 11437 & 0.34 & 15512 & 1.54 & 954.02 & 983.29 \\\\
600-30-4c & 705601 & 0.41 & 14535 & 0.27 & 17902 & 4.13 & 45.32 & 58.49 \\\\
600-30-4d & 4150775 & 0.10 & 17603 & 0.98 & 18025 & 1.11 & 67.78 & 74.82 \\\\
600-30-4e & 3514040 & 3.28 & 18513 & 0.18 & 14803 & 0.23 & 48.99 & 70.13 \\\\"""


def get_customer_count(line):
    m = re.match(r"(\d+)-", line.strip())
    if m:
        return int(m.group(1))
    return 0


def filter_rows(rows_text, min_customers, max_customers):
    filtered = []
    for line in rows_text.strip().split("\n"):
        count = get_customer_count(line)
        if min_customers <= count <= max_customers:
            filtered.append(line.replace("\\\\", "\\\\"))
    return "\n".join(filtered)


def compute_averages(rows_text):
    tsba_gaps, tsba_times = [], []
    hgamp_gaps, hgamp_times = [], []
    ds_gaps, ds_tlas, ds_ttotals = [], [], []
    for line in rows_text.strip().split("\n"):
        parts = [p.strip() for p in line.replace("\\\\", "").split("&")]
        if len(parts) >= 9:
            tsba_gaps.append(float(parts[2]))
            tsba_times.append(float(parts[3]))
            hgamp_gaps.append(float(parts[4]))
            hgamp_times.append(float(parts[5]))
            ds_gaps.append(float(parts[6]))
            ds_tlas.append(float(parts[7]))
            ds_ttotals.append(float(parts[8]))
    return {
        'tsba_gap': np.mean(tsba_gaps),
        'tsba_time': np.mean(tsba_times),
        'hgamp_gap': np.mean(hgamp_gaps),
        'hgamp_time': np.mean(hgamp_times),
        'ds_gap': np.mean(ds_gaps),
        'ds_tla': np.mean(ds_tlas),
        'ds_ttotal': np.mean(ds_ttotals),
    }


def generate_table(rows_text, caption, label):
    avgs = compute_averages(rows_text)
    avg_row = (
        rf"\bfseries Average & \multicolumn{{1}}{{c}}{{\bfseries --}} & "
        rf"\bfseries {avgs['tsba_gap']:.2f} & \bfseries {avgs['tsba_time']:.0f} & "
        rf"\bfseries {avgs['hgamp_gap']:.2f} & \bfseries {avgs['hgamp_time']:.0f} & "
        rf"\bfseries {avgs['ds_gap']:.2f} & \bfseries {avgs['ds_tla']:.2f} & "
        rf"\bfseries {avgs['ds_ttotal']:.2f} \\"
    )
    return rf"""
\begin{{table}}[h]
\centering
\caption{{{caption}}}
\label{{{label}}}
\begingroup
\tiny
\setlength{{\tabcolsep}}{{4pt}}
\renewcommand{{\arraystretch}}{{1.05}}
\sisetup{{
  group-separator = {{}},
  group-minimum-digits = 4,
  table-number-alignment = center,
  detect-weight,
  detect-inline-weight = math
}}
\setlength{{\tabcolsep}}{{1pt}}
\begin{{tabular*}}{{\linewidth}}{{
  @{{\extracolsep{{\fill}}}}
    l
    l
    S[table-format=2.2]
    S[table-format=5.0]
    S[table-format=2.2]
    S[table-format=5.0]
    S[table-format=2.2]
    S[table-format=4.2]
    S[table-format=4.2]
}}
\toprule
\multicolumn{{2}}{{c}}{{}} &
\multicolumn{{2}}{{c}}{{\text{{TSBA$_{{\text{{basic}}}}$}}}} &
\multicolumn{{2}}{{c}}{{\text{{HGAMP}}}} &
\multicolumn{{3}}{{c}}{{\text{{NEO-DS}}}} \\
\cmidrule(lr){{3-4}} \cmidrule(lr){{5-6}} \cmidrule(lr){{7-9}}
Instance & BKS &
\text{{$E^{{\text{{gap}}}}_{{BKS}}$ (\%)}} & \text{{$T_{{\text{{total}}}}$ (s)}} &
\text{{$E^{{\text{{gap}}}}_{{BKS}}$ (\%)}} & \text{{$T_{{\text{{total}}}}$ (s)}} &
\text{{$E^{{\text{{gap}}}}_{{BKS}}$ (\%)}} & \text{{$T^{{\text{{LA}}}}$ (s)}} & \text{{$T_{{\text{{total}}}}$ (s)}} \\
\midrule
{rows_text}
\midrule
{avg_row}
\midrule
\multicolumn{{2}}{{l}}{{Processor}}
  & \multicolumn{{2}}{{r}}{{Xeon E5-2670}}
  & \multicolumn{{2}}{{r}}{{Xeon E-2670}}
  & \multicolumn{{3}}{{r}}{{Xeon Gold 6248R}} \\
\multicolumn{{2}}{{l}}{{GHz}}
  & \multicolumn{{2}}{{r}}{{2.6}}
  & \multicolumn{{2}}{{r}}{{2.5}}
  & \multicolumn{{3}}{{r}}{{3.0}}\\
\bottomrule
\end{{tabular*}}
\endgroup
\end{{table}}
"""


rows_100_200 = filter_rows(all_rows, 100, 200)
rows_300_400 = filter_rows(all_rows, 300, 400)
rows_500_600 = filter_rows(all_rows, 500, 600)

table_100_200 = generate_table(
    rows_100_200,
    r"Detailed results on the $\mathbb{S}$ benchmark of \citet{schneider2019large} (100--200 customers). BKS values are taken from \citet{he2025hybrid}.",
    "tab:setS-100-200"
)

table_300_400 = generate_table(
    rows_300_400,
    r"Detailed results on the $\mathbb{S}$ benchmark of \citet{schneider2019large} (300--400 customers). BKS values are taken from \citet{he2025hybrid}.",
    "tab:setS-300-400"
)

table_500_600 = generate_table(
    rows_500_600,
    r"Detailed results on the $\mathbb{S}$ benchmark of \citet{schneider2019large} (500--600 customers). BKS values are taken from \citet{he2025hybrid}.",
    "tab:setS-500-600"
)

with open("sota_schneider_100_200.tex", "w") as f:
    f.write(table_100_200)
print("Wrote: sota_schneider_100_200.tex")

with open("sota_schneider_300_400.tex", "w") as f:
    f.write(table_300_400)
print("Wrote: sota_schneider_300_400.tex")

with open("sota_schneider_500_600.tex", "w") as f:
    f.write(table_500_600)
print("Wrote: sota_schneider_500_600.tex")

table_all = generate_table(
    all_rows,
    r"Detailed results on the $\mathbb{S}$ benchmark of \citet{schneider2019large} (all instances). BKS values are taken from \citet{he2025hybrid}.",
    "tab:setS-all"
)

with open("sota_schneider_all.tex", "w") as f:
    f.write(table_all)
print("Wrote: sota_schneider_all.tex")

print("\nDone! Generated 4 separate latex tables.")
